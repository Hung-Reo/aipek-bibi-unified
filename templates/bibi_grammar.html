<!DOCTYPE html>
<html lang="vi">
<head>
  <script>
    // Thi·∫øt l·∫≠p ch·∫ø ƒë·ªô giao di·ªán ngay khi t·∫£i trang
    (function() {
      const savedUIMode = localStorage.getItem('bibi-ui-mode') || 'modern';
      if (savedUIMode === 'modern') {
        document.documentElement.classList.add('modern-ui');
      }
    })();
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BiBi D·∫°y Ng·ªØ Ph√°p</title>
  <link rel="stylesheet" href="/static/css/style.css" />
  <link rel="stylesheet" href="/static/css/grammar.css" />
  <link rel="stylesheet" href="/static/css/bibi_grammar_modern.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <!-- Th√™m th∆∞ vi·ªán docx v√† FileSaver ƒë·ªÉ h·ªó tr·ª£ xu·∫•t Word v√† l∆∞u file -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/5.5.0/docx.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <!-- CSS ƒë·∫∑c bi·ªát ch·ªâ √°p d·ª•ng khi in -->
  <link rel="stylesheet" href="/static/css/print.css" media="print" />
  <!-- Th√™m feedback v√†o c√°c script imports hi·ªán c√≥ -->
  <script type="module" src="/static/js/controllers/feedback.js"></script>
</head>
<body>
  <!-- Container c√¥ l·∫≠p cho UI hi·ªán ƒë·∫°i -->
  <div class="bibi-grammar-app" id="bibi-grammar-app">
    <!-- Header m·ªõi -->
    <header class="smart-header">
      <div class="header-left">
        <a href="/" class="home-btn">
          <i class="fas fa-home"></i>
          <span>Trang ch·ªß</span>
        </a>
        <div class="logo">ü§ñ BiBi</div>
      </div>
      
      <div class="header-center">
        <div class="search-container">
          <i class="fas fa-search search-icon"></i>
          <input type="text" id="topic-search" placeholder="T√¨m ki·∫øm ch·ªß ƒë·ªÅ ng·ªØ ph√°p...">
        </div>
      </div>
      
      <div class="header-right">
        <!-- Ch·ªâ b√°o RAG -->
        <div id="rag-indicator" class="rag-status" title="Tr·∫°ng th√°i k·∫øt n·ªëi v·ªõi c∆° s·ªü d·ªØ li·ªáu">
          <i class="fas fa-database"></i>
          <span class="rag-status-text">RAG: ƒêang ki·ªÉm tra...</span>
        </div>
        <!-- N√∫t chuy·ªÉn ƒë·ªïi giao di·ªán m·ªõi -->
        <button id="ui-mode-toggle" class="ui-mode-switch">
          <i class="fas fa-sync-alt"></i>
          <span>Giao di·ªán</span>
        </button>
        <div class="language-selector">
          <button id="lang-vi" class="lang-btn active">üáªüá≥</button>
          <button id="lang-en" class="lang-btn">üá¨üáß</button>
          <button id="lang-both" class="lang-btn">üáªüá≥üá¨üáß</button>
        </div>
        <button id="theme-toggle" class="theme-btn">
          <i class="fas fa-moon"></i>
        </button>
      </div>
    </header>

  <!-- Navigation tabs d∆∞·ªõi header -->
  <nav class="tabs-navigation">
    <div class="tabs-container">
      <button id="explain-tab" class="tab-btn active">
        <i class="fas fa-book"></i>
        <span>Gi·∫£i th√≠ch</span>
      </button>
      <button id="examples-tab" class="tab-btn">
        <i class="fas fa-list"></i>
        <span>V√≠ d·ª•</span>
      </button>
      <button id="exercises-tab" class="tab-btn">
        <i class="fas fa-tasks"></i>
        <span>B√†i t·∫≠p</span>
      </button>
      <button id="mistakes-tab" class="tab-btn">
        <i class="fas fa-exclamation-triangle"></i>
        <span>L·ªói th∆∞·ªùng g·∫∑p</span>
      </button>
    </div>
  </nav>

  <!-- Gi·ªØ nguy√™n c·∫•u tr√∫c main container -->
  <div class="grammar-container">
    <!-- Sidebar b√™n tr√°i -->
    <div class="grammar-sidebar">
      <h3>H·ªó tr·ª£ d·∫°y ng·ªØ ph√°p ti·∫øng Anh</h3>
      
      <div class="grammar-form">
        <div class="form-group">
          <label>Ch·ªçn ch·ªß ƒë·ªÅ ng·ªØ ph√°p:</label>
          <select id="grammar-topic">
            <option value="">-- Ch·ªçn ch·ªß ƒë·ªÅ --</option>
            <option value="Present Simple">Th√¨ hi·ªán t·∫°i ƒë∆°n</option>
            <option value="Present Continuous">Th√¨ hi·ªán t·∫°i ti·∫øp di·ªÖn</option>
            <option value="Past Simple">Th√¨ qu√° kh·ª© ƒë∆°n</option>
            <option value="Articles">M·∫°o t·ª´ (a, an, the)</option>
            <option value="Pronouns">ƒê·∫°i t·ª´</option>
            <option value="Comparative and Superlative">So s√°nh h∆°n v√† so s√°nh nh·∫•t</option>
            <option value="Modal verbs">ƒê·ªông t·ª´ khuy·∫øt thi·∫øu</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Ho·∫∑c nh·∫≠p ƒëi·ªÉm ng·ªØ ph√°p c·∫ßn gi·∫£i th√≠ch:</label>
          <input type="text" id="grammar-query" placeholder="VD: c√°ch s·ª≠ d·ª•ng 'used to'">
        </div>
        
        <button id="explain-grammar-btn" class="action-btn primary-btn">
          <i class="fas fa-book"></i> Gi·∫£i th√≠ch ng·ªØ ph√°p
        </button>
        
        <div class="action-buttons">
          <button id="generate-examples-btn" class="action-btn">
            <i class="fas fa-list"></i> T·∫°o v√≠ d·ª•
          </button>
          <button id="generate-exercises-btn" class="action-btn">
            <i class="fas fa-tasks"></i> T·∫°o b√†i t·∫≠p
          </button>
          <button id="common-mistakes-btn" class="action-btn">
            <i class="fas fa-exclamation-triangle"></i> L·ªói th∆∞·ªùng g·∫∑p
          </button>
        </div>
      </div>
    </div>
    
    <!-- Khu v·ª±c n·ªôi dung b√™n ph·∫£i -->
    <div class="grammar-content">
      <!-- Tab content: Gi·∫£i th√≠ch -->
      <div id="explain-content" class="tab-content active">
        <div id="grammar-output" class="output-area">
          <div class="welcome-message">
            <h3>ü§ñ Tr·ª£ l√Ω d·∫°y ng·ªØ ph√°p ti·∫øng Anh</h3>
            <p>Ch·ªçn m·ªôt ch·ªß ƒë·ªÅ ng·ªØ ph√°p ho·∫∑c nh·∫≠p c√¢u h·ªèi b√™n tr√°i ƒë·ªÉ b·∫Øt ƒë·∫ßu.</p>
            <p>C√¥ng c·ª• n√†y gi√∫p gi√°o vi√™n:</p>
            <ul>
              <li>Nh·∫≠n gi·∫£i th√≠ch ng·ªØ ph√°p chi ti·∫øt ph√π h·ª£p v·ªõi h·ªçc sinh l·ªõp 6</li>
              <li>T·∫°o v√≠ d·ª• minh h·ªça th·ª±c t·∫ø v√† d·ªÖ hi·ªÉu</li>
              <li>T·∫°o b√†i t·∫≠p cho h·ªçc sinh th·ª±c h√†nh</li>
              <li>Hi·ªÉu c√°c l·ªói th∆∞·ªùng g·∫∑p ƒë·ªÉ t·∫≠p trung gi·∫£ng d·∫°y hi·ªáu qu·∫£</li>
            </ul>
          </div>
        </div>
      </div>
      
      <!-- Tab content: V√≠ d·ª• -->
      <div id="examples-content" class="tab-content">
        <div id="examples-output" class="output-area"></div>
      </div>
      
      <!-- Tab content: B√†i t·∫≠p -->
      <div id="exercises-content" class="tab-content">
        <div id="exercises-output" class="output-area"></div>
      </div>
      
      <!-- Tab content: L·ªói th∆∞·ªùng g·∫∑p -->
      <div id="mistakes-content" class="tab-content">
        <div id="mistakes-output" class="output-area"></div>
      </div>

      <div class="loading-indicator" id="loading-indicator" style="display:none;">
        <div class="spinner"></div>
        <p>ƒêang x·ª≠ l√Ω...</p>
      </div>
    </div>
  </div>

  <!-- Import scripts - Quan tr·ªçng: th·ª© t·ª± import ph·∫£i ƒë√∫ng -->
  <script src="/static/js/controllers/api_rag.js" type="module"></script>
  <script src="/static/js/controllers/api.js"></script>
  <script src="/static/js/controllers/ui-mode-manager.js" type="module"></script>
  <script src="/static/js/controllers/grammar.js" type="module"></script>

  <!-- Th√™m script kh·ªüi ƒë·ªông -->
  <script type="module">
    // Kh·ªüi ƒë·ªông ·ª©ng d·ª•ng khi trang ƒë√£ t·∫£i
    document.addEventListener('DOMContentLoaded', () => {
      console.log('üöÄ BiBi Grammar app initialized');
      
      // Ki·ªÉm tra tr·∫°ng th√°i dark mode
      if (localStorage.getItem('bibi-theme') === 'dark') {
        document.body.classList.add('dark-theme');
      }
      
      // Ki·ªÉm tra phi√™n b·∫£n cho c·∫≠p nh·∫≠t cache
      const APP_VERSION = '1.0.0';
      const lastVersion = localStorage.getItem('bibi-app-version');
      
      if (lastVersion !== APP_VERSION) {
        // X√≥a cache khi c·∫≠p nh·∫≠t phi√™n b·∫£n
        console.log('Ph√°t hi·ªán phi√™n b·∫£n m·ªõi, ƒëang x√≥a cache...');
        localStorage.setItem('bibi-app-version', APP_VERSION);
        
        // Import GrammarCache v√† x√≥a cache
        import('/static/js/controllers/grammar/grammar-cache.js').then(module => {
          const GrammarCache = module.GrammarCache;
          const cleared = GrammarCache.clearAllCache();
          console.log(`ƒê√£ x√≥a ${cleared} m·ª•c cache c≈©`);
        }).catch(err => {
          console.error('L·ªói khi x√≥a cache:', err);
        });
      }
    });
  </script>

  <script>
    // Debug tools
    (function() {
      const debugPanel = document.getElementById('debug-panel');
      const toggleDebug = document.getElementById('toggle-debug');
      const currentUIMode = document.getElementById('current-ui-mode');
      const currentLang = document.getElementById('current-lang');
      
      // Only run debug code if elements exist
      if (debugPanel && toggleDebug && currentUIMode && currentLang) {
        // Show debug panel in development
        if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
          debugPanel.style.display = 'block';
        }
        
        // Toggle debug panel
        toggleDebug.addEventListener('click', function() {
          if (debugPanel.style.height === 'auto' || debugPanel.style.height === '') {
            debugPanel.style.height = '20px';
            toggleDebug.textContent = 'Show';
          } else {
            debugPanel.style.height = 'auto';
            toggleDebug.textContent = 'Hide';
          }
        });
        
        // Update debug info
        function updateDebugInfo() {
          if (window.uiModeManager) {
            currentUIMode.textContent = window.uiModeManager.getCurrentMode();
          }
          
          if (window.grammarController) {
            currentLang.textContent = window.grammarController.selectedLanguage;
          }
          
          setTimeout(updateDebugInfo, 1000);
        }
        
        updateDebugInfo();
      } else {
        console.log('üîß Debug panel elements not found - skipping debug initialization');
      }
    })();
  </script>

  <!-- Chat Follow-up Container -->
  <div id="follow-up-chat" class="follow-up-chat">
    <div class="chat-header">
      <h3>H·ªèi th√™m v·ªÅ ch·ªß ƒë·ªÅ n√†y</h3>
      <div class="chat-counter">C√≤n <span id="chat-count">5</span> c√¢u h·ªèi</div>
      <button id="close-chat" class="close-chat-btn"><i class="fa fa-times"></i></button>
    </div>

    <div id="chat-messages" class="chat-messages">
      <div class="system-message">
        B·∫°n c√≥ th·ªÉ h·ªèi th√™m 5 c√¢u h·ªèi v·ªÅ ch·ªß ƒë·ªÅ n√†y ƒë·ªÉ hi·ªÉu s√¢u h∆°n ho·∫∑c nh·∫≠n th√™m v√≠ d·ª•, b√†i t·∫≠p.
      </div>
    </div>
    
    <div class="suggested-questions" id="suggested-questions">
      <div class="suggest-title">C√¢u h·ªèi g·ª£i √Ω:</div>
      <div class="suggest-buttons">
        <!-- C√°c n√∫t c√¢u h·ªèi g·ª£i √Ω s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
      </div>
    </div>
    
    <div class="chat-input-container">
      <textarea id="chat-input" placeholder="Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n..." rows="2"></textarea>
      <button id="send-chat" class="send-chat-btn"><i class="fa fa-paper-plane"></i></button>
    </div>
  </div>

  <!-- Overlay khi chat hi·ªÉn th·ªã -->
  <div id="chat-overlay" class="chat-overlay"></div>

  <!-- Hidden chat-toggle element -->
  <div id="chat-toggle" style="display: none;"></div>

  <style>
  .follow-up-chat {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 380px;
    max-width: 90vw;
    height: 500px;
    max-height: 80vh;
    background-color: white;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    display: flex;
    flex-direction: column;
    z-index: 1000;
    display: none;
    overflow: hidden;
  }

  .chat-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    background: #4CAF50;
    color: white;
    border-radius: 10px 10px 0 0;
  }

  .chat-header h3 {
    margin: 0;
    font-size: 16px;
  }

  .chat-counter {
    font-size: 13px;
    background: rgba(255,255,255,0.2);
    padding: 3px 8px;
    border-radius: 12px;
  }

  .close-chat-btn {
    background: transparent;
    border: none;
    color: white;
    font-size: 18px;
    cursor: pointer;
  }

  .chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 15px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .system-message {
    background-color: #f0f0f0;
    padding: 10px;
    border-radius: 10px;
    font-size: 13px;
    color: #555;
    max-width: 90%;
    align-self: center;
  }

  .user-message, .bot-message {
    max-width: 80%;
    padding: 10px 12px;
    border-radius: 12px;
    margin-bottom: 5px;
  }

  .user-message {
    background-color: #e3f2fd;
    align-self: flex-end;
  }

  .bot-message {
    background-color: #f1f1f1;
    align-self: flex-start;
  }

  .suggested-questions {
    padding: 10px 15px;
    background-color: #f9f9f9;
    border-top: 1px solid #eee;
  }

  .suggest-title {
    font-size: 13px;
    color: #666;
    margin-bottom: 8px;
  }

  .suggest-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  .suggest-btn {
    background-color: #e9e9e9;
    border: none;
    border-radius: 15px;
    padding: 5px 10px;
    font-size: 12px;
    cursor: pointer;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 180px;
    transition: background-color 0.2s;
  }

  .suggest-btn:hover {
    background-color: #d9d9d9;
  }

  .chat-input-container {
    display: flex;
    padding: 10px;
    border-top: 1px solid #eee;
    background-color: white;
  }

  #chat-input {
    flex: 1;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 20px;
    resize: none;
    font-family: inherit;
  }

  .send-chat-btn {
    width: 40px;
    height: 40px;
    margin-left: 10px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .chat-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0,0,0,0.3);
    z-index: 999;
    display: none;
  }

  .message-time {
    font-size: 11px;
    color: #999;
    margin-top: 3px;
    text-align: right;
  }

  .typing-indicator {
    display: flex;
    padding: 10px;
    align-self: flex-start;
  }

  .typing-indicator span {
    height: 8px;
    width: 8px;
    background-color: #bbb;
    border-radius: 50%;
    display: inline-block;
    margin: 0 2px;
    animation: typing 1s infinite;
  }

  .typing-indicator span:nth-child(2) {
    animation-delay: 0.2s;
  }

  .typing-indicator span:nth-child(3) {
    animation-delay: 0.4s;
  }

  @keyframes typing {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-5px); }
    100% { transform: translateY(0px); }
  }
  .grammar-card-actions {
  margin-top: 15px;
  display: flex;
  justify-content: flex-end;
  border-top: 1px solid #eee;
  padding-top: 10px;
  }

  .chat-btn {
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 20px;
    padding: 8px 15px;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 5px;
    transition: background-color 0.2s;
  }

  .chat-btn:hover {
    background-color: #3d8b40;
  }
  /* CSS cho Feedback Form */
  .feedback-container {
    margin-top: 30px;
    padding: 15px;
    border-top: 1px dashed #ddd;
    background-color: #f9f9f9;
    border-radius: 8px;
  }

  .feedback-header h4 {
    margin: 0 0 5px 0;
    font-size: 16px;
    color: #444;
  }

  .feedback-subtitle {
    font-size: 13px;
    color: #666;
    margin-top: 0;
  }

  .feedback-rating {
    display: flex;
    align-items: center;
    margin: 10px 0;
  }

  .feedback-rating p {
    margin: 0 10px 0 0;
  }

  .star-rating {
    display: flex;
  }

  .star {
    font-size: 24px;
    color: #ddd;
    cursor: pointer;
    margin-right: 5px;
    transition: color 0.2s;
  }

  .star.selected {
    color: #FFD700;
  }

  .rating-text {
    font-size: 13px;
    margin-left: 10px;
    color: #666;
  }

  .feedback-comment textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    resize: vertical;
    font-family: inherit;
  }

  .feedback-actions {
    margin-top: 10px;
    text-align: right;
  }

  .feedback-submit-btn {
    background-color: #4CAF50;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.2s;
  }

  .feedback-submit-btn:hover {
    background-color: #45a049;
  }

  .feedback-thank-you {
    padding: 20px;
    text-align: center;
    color: #4CAF50;
  }

  .feedback-thank-you p {
    font-size: 16px;
  }

  /* Styling cho ph·∫ßn ch·∫ø ƒë·ªô dark */
  .dark-theme .feedback-container {
    background-color: #2a2a2a;
    border-top: 1px dashed #444;
  }

  .dark-theme .feedback-header h4,
  .dark-theme .feedback-subtitle,
  .dark-theme .feedback-rating p,
  .dark-theme .rating-text {
    color: #ddd;
  }

  .dark-theme .feedback-comment textarea {
    background-color: #333;
    color: #ddd;
    border-color: #444;
  }

  .dark-theme .star:not(.selected) {
    color: #555;
  }

  </style>
  <!-- Import module GrammarChat -->
  <script type="module">
    // T·∫£i module GrammarChat m·ªôt c√°ch an to√†n v·ªõi nhi·ªÅu ƒë∆∞·ªùng d·∫´n d·ª± ph√≤ng
    try {
      console.log('üîÑ ƒêang t·∫£i module chat...');
      
      // Th·ª≠ v·ªõi nhi·ªÅu ƒë∆∞·ªùng d·∫´n kh√°c nhau ƒë·ªÉ t√¨m ƒë√∫ng v·ªã tr√≠ file
      const possiblePaths = [
        '/static/js/controllers/grammar-chat.js',
        './static/js/controllers/grammar-chat.js', 
        '/static/js/controllers/grammar-chat.js',
        '/static/js/controllers/grammar/grammar-chat.js'
      ];
      
      // Bi·∫øn ƒë·ªÉ theo d√µi xem file ƒë√£ ƒë∆∞·ª£c t·∫£i th√†nh c√¥ng ch∆∞a
      let loaded = false;
      
      // H√†m th·ª≠ t·∫£i t·ª´ng ƒë∆∞·ªùng d·∫´n
      async function tryLoadModule() {
        for (const path of possiblePaths) {
          try {
            console.log(`üîç Th·ª≠ t·∫£i t·ª´: ${path}`);
            const module = await import(path);
            console.log(`‚úÖ T·∫£i th√†nh c√¥ng t·ª´: ${path}`);
            window.GrammarChat = module.GrammarChat;
            loaded = true;
            break; // Tho√°t kh·ªèi v√≤ng l·∫∑p n·∫øu t·∫£i th√†nh c√¥ng
          } catch (err) {
            console.log(`‚ùå Th·∫•t b·∫°i khi t·∫£i t·ª´: ${path}`);
          }
        }
        
        if (!loaded) {
          console.error('‚ùå Kh√¥ng th·ªÉ t·∫£i module GrammarChat t·ª´ b·∫•t k·ª≥ ƒë∆∞·ªùng d·∫´n n√†o');
        }
      }
      
      tryLoadModule();
    } catch (error) {
      console.error('‚ùå L·ªói khi thi·∫øt l·∫≠p module chat:', error);
    }
  </script>
  <style>
    /* ·∫®n container chat tr√πng l·∫∑p */
    .follow-up-container {
      display: none !important; /* ·∫®n container c≈© */
    }
    
    /* ƒê·∫£m b·∫£o n√∫t trong grammar-card-actions hi·ªÉn th·ªã ƒë√∫ng */
    .grammar-card-actions .chat-btn {
      display: flex !important;
    }
  </style>
  <!-- N√∫t chat to√†n c·ª•c -->
<button id="chat-overlay-toggle" class="chat-global-button" title="H·ªèi th√™m" style="display: none;">
  <i class="fas fa-comment"></i> H·ªèi th√™m
</button>

<!-- Th√™m CSS cho n√∫t chat to√†n c·ª•c -->
<style>
  /* CSS cho n√∫t chat to√†n c·ª•c */
  .chat-global-button {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 50px;
    padding: 10px 20px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 5px;
    z-index: 900;
    transition: all 0.3s ease;
  }
  
  .chat-global-button:hover {
    transform: scale(1.05);
    background-color: #3d8b40;
  }
  
  /* ·∫®n n√∫t khi chat ƒëang hi·ªÉn th·ªã */
  .chat-global-button.hidden {
    display: none;
  }
  /* CSS cho g·ª£i √Ω d·∫°ng dropdown */
  .suggest-compact-btn {
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 15px;
    padding: 5px 10px;
    font-size: 12px;
    cursor: pointer;
    transition: background-color 0.2s;
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .suggest-compact-btn:hover {
    background-color: #3d8b40;
  }

  .suggest-dropdown {
    position: absolute;
    bottom: 100%;
    left: 0;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    width: 100%;
    max-height: 200px;
    overflow-y: auto;
    z-index: 10;
    display: none;
  }

  .suggest-item {
    padding: 8px 12px;
    border-bottom: 1px solid #eee;
    cursor: pointer;
    transition: background-color 0.2s;
  }

  .suggest-item:hover {
    background-color: #f5f5f5;
  }

  .suggest-item:last-child {
    border-bottom: none;
  }

  /* Di chuy·ªÉn ph·∫ßn g·ª£i √Ω v√†o v·ªã tr√≠ t·ªët h∆°n */
  .suggested-questions {
    position: relative;
    padding: 5px 15px;
    background-color: transparent;
    border-top: none;
  }
</style>

<!-- Script ƒë·ªÉ x·ª≠ l√Ω hi·ªÉn th·ªã/·∫©n n√∫t chat -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const chatButton = document.getElementById('chat-overlay-toggle');
    const chatContainer = document.getElementById('follow-up-chat');
    
    // ·∫®n n√∫t khi chat hi·ªÉn th·ªã, hi·ªán n√∫t khi chat ·∫©n
    function updateButtonVisibility() {
      if (chatContainer.style.display === 'flex') {
        chatButton.classList.add('hidden');
      } else {
        chatButton.classList.remove('hidden');
      }
    }
    
    // Ki·ªÉm tra ban ƒë·∫ßu
    updateButtonVisibility();
    
    // Theo d√µi khi chat hi·ªÉn th·ªã/·∫©n
    const observer = new MutationObserver((mutations) => {
      mutations.forEach(mutation => {
        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
          updateButtonVisibility();
        }
      });
    });
    
    observer.observe(chatContainer, { attributes: true });
  });
</script>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // ƒê·ª£i t·∫•t c·∫£ c√°c module t·∫£i xong
    setTimeout(() => {
      const chatButton = document.getElementById('chat-overlay-toggle');
      const chatContainer = document.getElementById('follow-up-chat');
      const chatOverlay = document.getElementById('chat-overlay');
      const closeButton = document.getElementById('close-chat');
      
      if (chatButton && chatContainer && chatOverlay) {
        console.log('‚úÖ T√¨m th·∫•y t·∫•t c·∫£ c√°c ph·∫ßn t·ª≠ chat');
        
        // X√≥a event listeners c≈©
        const newButton = chatButton.cloneNode(true);
        if (chatButton.parentNode) {
          chatButton.parentNode.replaceChild(newButton, chatButton);
        }
        
        // Th√™m s·ª± ki·ªán hi·ªÉn th·ªã chat
        newButton.addEventListener('click', () => {
          console.log('üñ±Ô∏è N√∫t H·ªèi th√™m ƒë∆∞·ª£c nh·∫•p');
          chatContainer.style.display = 'flex';
          chatOverlay.style.display = 'block';
        });
        
        // S·ª± ki·ªán ƒë√≥ng chat
        if (closeButton) {
          closeButton.addEventListener('click', () => {
            chatContainer.style.display = 'none';
            chatOverlay.style.display = 'none';
          });
        }
        
        if (chatOverlay) {
          chatOverlay.addEventListener('click', () => {
            chatContainer.style.display = 'none';
            chatOverlay.style.display = 'none';
          });
        }
      } else {
        console.error('‚ùå Kh√¥ng t√¨m th·∫•y ƒë·ªß c√°c ph·∫ßn t·ª≠ chat');
      }
    }, 1000);
  });
</script>

</body>
</html>

</body>
</html>